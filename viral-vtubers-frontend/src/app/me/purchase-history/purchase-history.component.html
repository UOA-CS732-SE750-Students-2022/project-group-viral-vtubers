<h1>Purchase History</h1>
<hr />

<ng-container *ngIf="purchases$ | async as purchases; else loading">
  <ng-container *ngIf="purchases.length > 0; else empty">
    <table>
      <tr class="table-head">
        <th class="product-col">Product</th>
        <th class="artist-col">Artist</th>
        <th class="date-col">Transaction Date</th>
        <th class="price-col">Price</th>
        <th class="download-col">Download</th>
      </tr>

      <ng-container *ngFor="let purchase of purchases">
        <tr *ngFor="let item of purchase.items">
          <td class="product-col">
            <div
              class="product-container"
              (click)="navigateToProduct(item.product.id)"
            >
              <img src="{{ item.product.titleImage }}" />
              <div>
                <h5>{{ item.product.name }}</h5>
                <p>
                  {{ item.fileName }}
                </p>
              </div>
            </div>
          </td>
          <td class="artist-col">
            <div
              class="artist-container"
              (click)="navigateToUser(item.product.id)"
            >
              <img src="{{ purchase.seller.profileImageURI }}" />
              <p>{{ purchase.seller.displayName }}</p>
            </div>
          </td>
          <td class="date-col">
            {{ purchase.placed }}
          </td>
          <td class="price-col">${{ item.price | number: "1.2-2" }}</td>
          <td class="download-col">
            <div class="download-container">
              <a routerLink="{{ item.file }}">
                <button>Download</button>
              </a>
            </div>
          </td>
        </tr>
      </ng-container>
    </table>
  </ng-container>
</ng-container>

<ng-template #empty>
  <div class="empty">
    <img src="assets/chibis/vivi.png" />
    <p>
      No purchases yet... Let's <a routerLink="/marketplace">start browsing</a>!
    </p>
  </div>
</ng-template>

<ng-template #loading>
  <div class="empty">
    <img src="assets/chibis/vivi.png" />
    <p>Loading...</p>
  </div>
</ng-template>
